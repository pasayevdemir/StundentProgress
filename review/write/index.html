<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qiym…ôtl…ôndirm…ô Yazma - PeerStack</title>
    <link rel="stylesheet" href="../../css/sidebar.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <div class="header">
                <button class="back-btn" onclick="studentDetailController.goBack()">‚Üê Geri</button>
                <h1>T…ôl…ôb…ô Qiym…ôtl…ôndirm…ô</h1>
            </div>

            <!-- T…ôl…ôb…ô M…ôlumatƒ± -->
            <div class="student-info-container">
                <div class="student-header">
                    <h2 id="studentName">T…ôl…ôb…ô Adƒ± Y√ºkl…ônir...</h2>
                    <div class="student-details">
                        <p><strong>Email:</strong> <span id="studentEmail">-</span></p>
                        <p><strong>Cohort:</strong> <span id="studentCohort">-</span></p>
                        <p><strong>Status:</strong> <span id="studentStatus">-</span></p>
                    </div>
                </div>
            </div>

            <!-- Modullar B√∂lm…ôsi -->
            <div class="modules-section">
                <h3>Modullar v…ô ƒ∞r…ôlil…ôm…ô</h3>
                
                <!-- Date Selector -->
                <div class="date-selector">
                    <div class="date-buttons">
                        <button type="button" class="date-btn active" data-days="7">H…ôft…ôlik</button>
                        <button type="button" class="date-btn" data-days="10">10 G√ºn</button>
                        <button type="button" class="date-btn" data-days="30">Aylƒ±q</button>
                    </div>
                    <div class="date-picker-wrapper">
                        <label for="customDate">üìÖ Tarix:</label>
                        <input type="date" id="customDate" class="custom-date-picker" max="">
                    </div>
                </div>
                
                <p class="section-subtitle">Son 1 h…ôft…ôlik progress d…ôyi≈üiklikl…ôri g√∂st…ôrilir</p>
                <div class="modules-grid" id="modulesGrid">
                    <!-- Modullar buraya y√ºkl…ôn…ôc…ôk -->
                </div>
            </div>

            <!-- Son H…ôft…ôlik Qiym…ôtl…ôndirm…ôl…ôr -->
            <div class="previous-reviews-section">
                <h3>Son H…ôft…ô Qiym…ôtl…ôndirm…ôl…ôr</h3>
                <div class="reviews-list" id="reviewsList">
                    <!-- Qiym…ôtl…ôndirm…ôl…ôr buraya y√ºkl…ôn…ôc…ôk -->
                </div>
            </div>

            <!-- Qiym…ôtl…ôndirm…ô Formu -->
            <div class="review-form-section">
                <div class="form-header-row">
                    <h3>Qiym…ôtl…ôndirm…ô Yaz</h3>
                    <div class="ai-all-wrapper">
                        <button type="button" class="ai-optimize-all-btn" id="optimizeAllBtn" title="B√ºt√ºn sah…ôl…ôri AI il…ô optimalla≈üdƒ±r">
                            ‚ú® Hamƒ±sƒ±nƒ± Optimalla≈üdƒ±r
                        </button>
                        <span class="ai-loading-spinner-inline hidden" id="optimizeAllSpinner"></span>
                    </div>
                </div>
                <form id="reviewForm">
                    <div class="form-group">
                        <div class="label-row">
                            <label for="learned">Bu g√ºn…ô kimi n…ô √∂yr…ôndi?</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="learned" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="learned"></span>
                            </div>
                        </div>
                        <textarea id="learned" name="learned" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn…ô kimi √∂yr…ôndiyi m√∂vzularƒ± yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="today">Bu g√ºn n…ô ed…ôc…ôkdir?</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="today" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="today"></span>
                            </div>
                        </div>
                        <textarea id="today" name="today" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn ed…ôc…ôyi tap≈üƒ±rƒ±qlarƒ± yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="feedback">√ñz Fikrin</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="feedback" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="feedback"></span>
                            </div>
                        </div>
                        <textarea id="feedback" name="feedback" rows="5" placeholder="√úmumi qiym…ôtl…ôndirm…ô v…ô t…ôklifl…ôrinizi yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="cancel-btn" onclick="studentDetailController.goBack()">L…ôƒüv et</button>
                        <button type="submit" class="submit-btn">G√∂nd…ôr</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Popup -->
    <div id="notificationPopup" class="notification-popup hidden">
        <div class="notification-content">
            <div class="notification-icon">‚úì</div>
            <p id="notificationMessage"></p>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../../js/config.js"></script>
    <script src="../../js/utils/UIHelper.js"></script>
    <script src="../../js/services/GeminiService.js"></script>
    <script src="../../js/models/StudentModel.js"></script>
    <script src="../../js/models/ProgressModel.js"></script>
    <script src="../../js/models/ReviewModel.js"></script>
    <script src="../../js/models/ReviewerModel.js"></script>
    <script src="../../js/controllers/StudentDetailController.js"></script>
    <script src="../../js/components/Sidebar.js"></script>
    <script>
        // Global variable to be initialized when DOM is ready
        let studentDetailController = null;
        
        // Get student ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = parseInt(urlParams.get('id'));
        
        if (!studentId) {
            alert('T…ôl…ôb…ô ID tapƒ±lmadƒ±');
            window.location.href = '../';
        }
        
        // Initialize on page load (sidebar auto-initializes via Sidebar.js)
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize controller
            studentDetailController = new StudentDetailController(studentId);
            studentDetailController.init();
        });
    </script>
</body>
</html>
