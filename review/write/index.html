<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qiym…ôtl…ôndirm…ô Yazma - PeerStack</title>
    <link rel="stylesheet" href="../../css/sidebar.css">
    <link rel="stylesheet" href="../../css/preload.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <script>
        (function() {
            document.body.classList.add('preload');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-theme');
            }
            const sidebarOpen = localStorage.getItem('sidebarOpen') !== 'false';
            if (!sidebarOpen) {
                document.body.classList.add('sidebar-collapsed');
            }
        })();
    </script>
    <div class="page-wrapper">
        <div class="container">
            <div class="header">
                <button class="back-btn" onclick="studentDetailController.goBack()">‚Üê Geri</button>
                <h1>T…ôl…ôb…ô Qiym…ôtl…ôndirm…ô</h1>
            </div>

            <!-- T…ôl…ôb…ô M…ôlumatƒ± -->
            <div class="student-info-container">
                <div class="student-header">
                    <h2 id="studentName">T…ôl…ôb…ô Adƒ± Y√ºkl…ônir...</h2>
                    <div class="student-details">
                        <p><strong>Email:</strong> <span id="studentEmail">-</span></p>
                        <p><strong>Cohort:</strong> <span id="studentCohort">-</span></p>
                        <p><strong>Status:</strong> <span id="studentStatus">-</span></p>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="write">Qiym…ôtl…ôndirm…ô Yaz</button>
                <button class="tab-btn" data-tab="presentation">Texniki T…ôqdimat</button>
                <button class="tab-btn" data-tab="presentationHistory">T…ôqdimat Tarix√ß…ôsi</button>
                <button class="tab-btn" data-tab="reviews">Stand-up Raportlar</button>
                <button class="tab-btn" data-tab="modules">Modullar</button>
            </div>

            <!-- Qiym…ôtl…ôndirm…ô Yaz Tab -->
            <div class="tab-content active" id="writeTab">
                <div class="review-form-section">
                    <div class="form-header-row">
                        <h3>Qiym…ôtl…ôndirm…ô Yaz</h3>
                        <div class="ai-all-wrapper">
                            <button type="button" class="ai-optimize-all-btn" id="optimizeAllBtn" title="B√ºt√ºn sah…ôl…ôri AI il…ô optimalla≈üdƒ±r">
                                ‚ú® Hamƒ±sƒ±nƒ± Optimalla≈üdƒ±r
                            </button>
                            <span class="ai-loading-spinner-inline hidden" id="optimizeAllSpinner"></span>
                        </div>
                    </div>
                    <form id="reviewForm">
                        <div class="form-group">
                            <div class="label-row">
                                <label for="learned">Bu g√ºn…ô kimi n…ô √∂yr…ôndi?</label>
                                <div class="ai-btn-wrapper">
                                    <button type="button" class="ai-optimize-btn" data-field="learned" title="AI il…ô optimalla≈üdƒ±r">
                                        ‚ú® AI
                                    </button>
                                    <span class="ai-loading-spinner-inline hidden" data-field="learned"></span>
                                </div>
                            </div>
                            <textarea id="learned" name="learned" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn…ô kimi √∂yr…ôndiyi m√∂vzularƒ± yazƒ±n..." required></textarea>
                        </div>

                        <div class="form-group">
                            <div class="label-row">
                                <label for="today">Bu g√ºn n…ô ed…ôc…ôkdir?</label>
                                <div class="ai-btn-wrapper">
                                    <button type="button" class="ai-optimize-btn" data-field="today" title="AI il…ô optimalla≈üdƒ±r">
                                        ‚ú® AI
                                    </button>
                                    <span class="ai-loading-spinner-inline hidden" data-field="today"></span>
                                </div>
                            </div>
                            <textarea id="today" name="today" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn ed…ôc…ôyi tap≈üƒ±rƒ±qlarƒ± yazƒ±n..." required></textarea>
                        </div>

                        <div class="form-group">
                            <div class="label-row">
                                <label for="feedback">√ñz Fikrin</label>
                                <div class="ai-btn-wrapper">
                                    <button type="button" class="ai-optimize-btn" data-field="feedback" title="AI il…ô optimalla≈üdƒ±r">
                                        ‚ú® AI
                                    </button>
                                    <span class="ai-loading-spinner-inline hidden" data-field="feedback"></span>
                                </div>
                            </div>
                            <textarea id="feedback" name="feedback" rows="5" placeholder="√úmumi qiym…ôtl…ôndirm…ô v…ô t…ôklifl…ôrinizi yazƒ±n..." required></textarea>
                        </div>

                        <div class="form-buttons">
                            <button type="button" class="cancel-btn" onclick="studentDetailController.goBack()">L…ôƒüv et</button>
                            <button type="submit" class="submit-btn">G√∂nd…ôr</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Texniki T…ôqdimat Tab -->
            <div class="tab-content" id="presentationTab">
                <div class="presentation-form-section">
                    <form id="presentationForm">
                        <div class="rating-group">
                            <label class="rating-label" for="TimeManagement">‚è±Ô∏è Vaxt ƒ∞dar…ôsi (Time Management)</label>
                            <select name="TimeManagement" id="TimeManagement" class="rating-select" required>
                                <option value="">Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>

                        <div class="rating-group">
                            <label class="rating-label" for="PresentationSkill">üé§ T…ôqdimat Bacarƒ±ƒüƒ±</label>
                            <select name="PresentationSkill" id="PresentationSkill" class="rating-select" required>
                                <option value="">Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                            <p class="rating-description">M√∂vzunu n…ô q…ôd…ôr aydƒ±n v…ô rahat izah ed…ô bilir.</p>
                        </div>

                        <div class="rating-group">
                            <label class="rating-label" for="SlidePreparation">üìä Slayd Hazƒ±rlƒ±q Bacarƒ±ƒüƒ±</label>
                            <select name="SlidePreparation" id="SlidePreparation" class="rating-select" required>
                                <option value="">Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                            <p class="rating-description">Slaydƒ±n m√∂vzunu n…ô q…ôd…ôr…ô …ôhat…ô etdiyini g√∂st…ôrir.</p>
                        </div>

                        <div class="rating-group">
                            <label class="rating-label" for="TopicCoverage">üìö M√∂vzu ∆èhat…ô Etm…ô Bacarƒ±ƒüƒ±</label>
                            <select name="TopicCoverage" id="TopicCoverage" class="rating-select" required>
                                <option value="">Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>

                        <div class="rating-group">
                            <label class="rating-label">üìà ƒ∞nki≈üaf</label>
                            <select name="Progress" class="rating-select" required>
                                <option value="" disabled selected>Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                            <p class="rating-description">2 h…ôft…ô …ôrzind…ô inki≈üafƒ± n…ô q…ôd…ôr nec…ô olub.</p>
                        </div>

                        <div class="rating-group">
                            <label class="rating-label">üé® Slayd Dizayn</label>
                            <select name="SlideDesign" class="rating-select" required>
                                <option value="" disabled selected>Se√ßin...</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                            <p class="rating-description">Slayd n…ô q…ôd…ôr visual g√∂rs…ôl…ôr var. N…ô q…ôd…ôr aydƒ±n doƒüru bi√ßimd…ô hazƒ±rlanƒ±b.</p>
                        </div>

                        <div class="form-group">
                            <label for="presentationDescription">üìù A√ßƒ±qlama</label>
                            <textarea id="presentationDescription" name="Description" rows="5" placeholder="T…ôqdimat haqqƒ±nda …ôlav…ô qeydl…ôrinizi yazƒ±n..." required></textarea>
                        </div>

                        <div class="form-buttons">
                            <button type="button" class="cancel-btn" onclick="studentDetailController.clearPresentationForm()">T…ômizl…ô</button>
                            <button type="submit" class="submit-btn">G√∂nd…ôr</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- T…ôqdimat Tarix√ß…ôsi Tab -->
            <div class="tab-content" id="presentationHistoryTab">
                <div class="presentation-history-section">
                    <div class="presentations-list" id="presentationsList">
                        <!-- T…ôqdimatlar buraya y√ºkl…ôn…ôc…ôk -->
                    </div>
                </div>
            </div>

            <!-- Qiym…ôtl…ôr Tab -->
            <div class="tab-content" id="reviewsTab">
                <div class="previous-reviews-section">
                    <div class="reviews-list" id="reviewsList">
                        <!-- Qiym…ôtl…ôndirm…ôl…ôr buraya y√ºkl…ôn…ôc…ôk -->
                    </div>
                </div>
            </div>

            <!-- Modullar Tab -->
            <div class="tab-content" id="modulesTab">
                <div class="modules-section">
                    
                    <!-- Date Selector -->
                    <div class="date-selector">
                        <div class="date-buttons">
                            <button type="button" class="date-btn active" data-days="7">H…ôft…ôlik</button>
                            <button type="button" class="date-btn" data-days="10">10 G√ºn</button>
                            <button type="button" class="date-btn" data-days="30">Aylƒ±q</button>
                        </div>
                        <div class="date-picker-wrapper">
                            <label for="customDate">üìÖ Tarix:</label>
                            <input type="date" id="customDate" class="custom-date-picker" max="">
                        </div>
                    </div>
                    
                    <p class="section-subtitle">Son 1 h…ôft…ôlik progress d…ôyi≈üiklikl…ôri g√∂st…ôrilir</p>
                    <div class="modules-grid" id="modulesGrid">
                        <!-- Modullar buraya y√ºkl…ôn…ôc…ôk -->
                    </div>
                </div>
            </div>

            <!-- Qiym…ôtl…ôr Tab -->
            <div class="tab-content" id="reviewsTab">
                <div class="previous-reviews-section">
                    <h3>Son Qiym…ôtl…ôndirm…ôl…ôr</h3>
                    <div class="reviews-list" id="reviewsList">
                        <!-- Qiym…ôtl…ôndirm…ôl…ôr buraya y√ºkl…ôn…ôc…ôk -->
                    </div>
                </div>
            </div>

            <!-- Qiym…ôtl…ôndirm…ô Yaz Tab -->
            <div class="tab-content" id="writeTab">
                <div class="review-form-section">
                <div class="form-header-row">
                    <h3>Qiym…ôtl…ôndirm…ô Yaz</h3>
                    <div class="ai-all-wrapper">
                        <button type="button" class="ai-optimize-all-btn" id="optimizeAllBtn" title="B√ºt√ºn sah…ôl…ôri AI il…ô optimalla≈üdƒ±r">
                            ‚ú® Hamƒ±sƒ±nƒ± Optimalla≈üdƒ±r
                        </button>
                        <span class="ai-loading-spinner-inline hidden" id="optimizeAllSpinner"></span>
                    </div>
                </div>
                <form id="reviewForm">
                    <div class="form-group">
                        <div class="label-row">
                            <label for="learned">Bu g√ºn…ô kimi n…ô √∂yr…ôndi?</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="learned" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="learned"></span>
                            </div>
                        </div>
                        <textarea id="learned" name="learned" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn…ô kimi √∂yr…ôndiyi m√∂vzularƒ± yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="today">Bu g√ºn n…ô ed…ôc…ôkdir?</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="today" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="today"></span>
                            </div>
                        </div>
                        <textarea id="today" name="today" rows="5" placeholder="T…ôl…ôb…ônin bu g√ºn ed…ôc…ôyi tap≈üƒ±rƒ±qlarƒ± yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="feedback">√ñz Fikrin</label>
                            <div class="ai-btn-wrapper">
                                <button type="button" class="ai-optimize-btn" data-field="feedback" title="AI il…ô optimalla≈üdƒ±r">
                                    ‚ú® AI
                                </button>
                                <span class="ai-loading-spinner-inline hidden" data-field="feedback"></span>
                            </div>
                        </div>
                        <textarea id="feedback" name="feedback" rows="5" placeholder="√úmumi qiym…ôtl…ôndirm…ô v…ô t…ôklifl…ôrinizi yazƒ±n..." required></textarea>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="cancel-btn" onclick="studentDetailController.goBack()">L…ôƒüv et</button>
                        <button type="submit" class="submit-btn">G√∂nd…ôr</button>
                    </div>
                </form>
            </div>
            </div>
        </div>
    </div>

    <!-- Notification Popup -->
    <div id="notificationPopup" class="notification-popup hidden">
        <div class="notification-content">
            <div class="notification-icon">‚úì</div>
            <p id="notificationMessage"></p>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../../js/config.js"></script>
    <script src="../../js/utils/UIHelper.js"></script>
    <script src="../../js/services/GeminiService.js"></script>
    <script src="../../js/models/StudentModel.js"></script>
    <script src="../../js/models/ProgressModel.js"></script>
    <script src="../../js/models/ReviewModel.js"></script>
    <script src="../../js/models/ReviewerModel.js"></script>
    <script src="../../js/models/TechnicalPresentationModel.js"></script>
    <script src="../../js/controllers/StudentDetailController.js"></script>
    <script src="../../js/components/Sidebar.js"></script>
    <script>
        // Global variable to be initialized when DOM is ready
        let studentDetailController = null;
        
        // Get student ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const studentId = parseInt(urlParams.get('id'));
        
        if (!studentId) {
            alert('T…ôl…ôb…ô ID tapƒ±lmadƒ±');
            window.location.href = '../';
        }
        
        // Initialize on page load (sidebar auto-initializes via Sidebar.js)
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize controller
            studentDetailController = new StudentDetailController(studentId);
            studentDetailController.init();
        });
    </script>
</body>
</html>
